---
title: 库存超卖少卖问题
date: 2022-06-27 08:55:07
categories:
- 电商
---

# 1 库存超卖少卖
* 接口幂等
* SAGA保证一致性
* 未支付，MQ延迟取消订单
* MySQL乐观锁保证扣减库存原子性
* 对账（调用失败，实际扣减成功；补偿失败）
* （秒杀）sku库存置于Redis，下单之前先DECR获取下单资格，DECR返回(>=0),则获取到资格,请求入Redis队列,定时任务下单; 
  备注：写本地队列可能会导致MySQL瞬时写入压力大，需要本地写入控制频率；
       下单请求直接入Redis队列，队列的长度不好准确控制，长度至少sku的库存数，但每个订单可能多个sku;

